########################################
#  This file was generated by hdlmake  #
#  http://ohwr.org/projects/hdl-make/  #
########################################

PROJECT := analogue2.xise
ISE_CRAP := *.b analogue2_summary.html *.tcl analogue2.bld analogue2.cmd_log *.drc analogue2.lso *.ncd analogue2.ngc analogue2.ngd analogue2.ngr analogue2.pad analogue2.par analogue2.pcf analogue2.prj analogue2.ptwx analogue2.stx analogue2.syr analogue2.twr analogue2.twx analogue2.gise $(PROJECT).gise analogue2.bgn analogue2.unroutes analogue2.ut analogue2.xpi analogue2.xst analogue2_bitgen.xwbt analogue2_envsettings.html analogue2_guide.ncd analogue2_map.map analogue2_map.mrp analogue2_map.ncd analogue2_map.ngm analogue2_map.xrpt analogue2_ngdbuild.xrpt analogue2_pad.csv analogue2_pad.txt analogue2_par.xrpt analogue2_summary.xml analogue2_usage.xml analogue2_xst.xrpt usage_statistics_webtalk.html par_usage_statistics.html webtalk.log webtalk_pn.xml run.tcl

#target for performing local synthesis
local: syn_pre_cmd check_tool
		echo "project open $(PROJECT)" > run.tcl
		echo "process run {Generate Programming File} -force rerun_all" >> run.tcl
		/home/james/opt/Xilinx/14.7/ISE_DS/ISE/bin/lin64/xtclsh run.tcl

check_tool:
		

syn_post_cmd: local
		

syn_pre_cmd:
		

#target for cleaing all intermediate stuff
clean:
		rm -f $(ISE_CRAP)
		rm -rf xst xlnx_auto_*_xdb iseconfig _xmsgs _ngo

#target for cleaning final files
mrproper:
		rm -f *.bit *.bin *.mcs

.PHONY: mrproper clean syn_pre_scipt syn_post_cmd local check_tool

USER:=$(HDLMAKE_RSYNTH_USER)#take the value from the environment
SERVER:=$(HDLMAKE_RSYNTH_SERVER)#take the value from the environment
ISE_PATH:=$(HDLMAKE_RSYNTH_ISE_PATH)
R_NAME:=james/analogue2
PORT:=22

__test_for_remote_synthesis_variables:
ifeq (x$(USER),x)
	@echo "Remote synthesis user is not set.You can set it by editing variable USER in the makefile or setting env. variable HDLMAKE_RSYNTH_USER." && false
endif
ifeq (x$(SERVER),x)
	@echo "Remote synthesis server is not set.You can set it by editing variable SERVER in the makefile or setting env. variable HDLMAKE_RSYNTH_SERVER." && false
endif
ifeq (x$(ISE_PATH),x)
	@echo "Remote synthesis server is not set.You can set it by editing variable ISE_PATH in the makefile or setting env. variable HDLMAKE_RSYNTH_ISE_PATH." && false
endif

CWD := $(shell pwd)

FILES := run.tcl \
../vhdl/adc.vhdl \
../vhdl/analogue2.vhdl \
../vhdl/shift_out.vhdl \
../vhdl/analogue2.ucf \
../vhdl/clock_divider.vhdl \
../vhdl/shift_in.vhdl \
analogue2.xise

#target for running synthesis in the remote location
remote: __test_for_remote_synthesis_variables __send __do_synthesis
__send_back: __do_synthesis
__do_synthesis: __send
__send: __test_for_remote_synthesis_variables

__send:
		ssh $(USER)@$(SERVER) 'mkdir -p $(R_NAME)'
		rsync -e 'ssh -p $(PORT)' -Ravl $(foreach file, $(FILES), $(shell readlink -f $(file))) $(USER)@$(SERVER):$(R_NAME)

__do_synthesis:
ifeq (x$(HDLMAKE_RSYNTH_USE_SCREEN), x1)
		ssh -t $(USER)@$(SERVER) 'screen bash -c "cd $(R_NAME)$(CWD) && $(HDLMAKE_RSYNTH_ISE_PATH)/xtclsh run.tcl"'
else
		ssh $(USER)@$(SERVER) 'cd $(R_NAME)$(CWD) && $(HDLMAKE_RSYNTH_ISE_PATH)/xtclsh run.tcl'
endif


sync: 
		cd .. && rsync -av $(USER)@$(SERVER):$(R_NAME)/$(CWD) . && cd $(CWD)

#target for removing stuff from the remote location
cleanremote:
		ssh $(USER)@$(SERVER) 'rm -rf $(R_NAME)'

